{
   "script": "document.getElementById('add-fav').addEventListener('click', async () => { try { const response = await fetch('https://n8n.c1euro.com/webhook/favoris', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ page: window.location.href }) }); let data = await response.json(); for (let key in data) { if (typeof data[key] === 'string') data[key] = data[key].replace(/^=/, ''); } if (data.code && data.url && data.image) { const popup = document.createElement('div'); popup.style = 'position: fixed; top: 0; left: 0; width: 100%; background: rgba(30, 30, 30, 0.7); color: white; display: flex; align-items: center; padding: 10px 5%; box-sizing: border-box; backdrop-filter: blur(10px); z-index: 9999; flex-wrap: nowrap; cursor: pointer; opacity: 0; transform: translateY(-20px); transition: opacity 0.3s ease, transform 0.3s ease;'; const imgEl = document.createElement('img'); imgEl.src = data.image; imgEl.alt = data.title || 'Produit'; imgEl.style = 'width:80px; height:80px; object-fit:cover; border-radius:8px; flex-shrink:0; margin-right:20px; cursor: pointer;'; imgEl.onclick = (e) => { e.stopPropagation(); window.location.href = data.url; }; const rightContainer = document.createElement('div'); rightContainer.style = 'display:flex; flex-direction:column; justify-content:center; gap:8px; flex:1; min-width:150px;'; const titleEl = document.createElement('h3'); let truncatedTitle = data.title.length > 19 ? data.title.slice(0,19)+'â€¦' : data.title; titleEl.textContent = truncatedTitle; titleEl.style = 'margin:0;font-size:16px;line-height:1.2;'; const actionContainer = document.createElement('div'); actionContainer.style = 'display:flex; align-items:center; gap:10px; flex-wrap:nowrap;'; const promoBubble = document.createElement('button'); promoBubble.style = 'background: #FF3B3B; padding:6px 12px; border-radius:20px; font-weight:bold; border:none; cursor:pointer; min-width:100px; text-align:center; white-space: nowrap;'; promoBubble.textContent = 'PROMO : ' + data.code; promoBubble.onclick = (e) => { e.stopPropagation(); navigator.clipboard.writeText(data.code); promoBubble.style.background = '#ff9000'; promoBubble.textContent = 'COPIER'; setTimeout(() => { promoBubble.style.background = '#FF3B3B'; promoBubble.textContent = 'PROMO : ' + data.code; }, 1500); }; const closeBtn = document.createElement('button'); const closeImg = document.createElement('img'); closeImg.src = 'https://image.mimistok.com/close.svg'; closeImg.alt = 'Fermer'; closeImg.style.width = '24px'; closeImg.style.height = '24px'; closeBtn.appendChild(closeImg); closeBtn.style = 'background: transparent; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; margin-left: auto; flex-shrink: 0; padding: 0;'; closeBtn.onclick = (e) => { e.stopPropagation(); popup.style.opacity = '0'; popup.style.transform = 'translateY(-20px)'; setTimeout(() => popup.remove(), 300); }; actionContainer.appendChild(promoBubble); rightContainer.appendChild(titleEl); rightContainer.appendChild(actionContainer); popup.appendChild(imgEl); popup.appendChild(rightContainer); popup.appendChild(closeBtn); popup.addEventListener('click', () => { popup.style.opacity = '0'; popup.style.transform = 'translateY(-20px)'; setTimeout(() => popup.remove(), 300); }); rightContainer.addEventListener('click', e => e.stopPropagation()); closeBtn.addEventListener('click', e => e.stopPropagation()); document.body.appendChild(popup); setTimeout(() => { popup.style.opacity = '1'; popup.style.transform = 'translateY(0)'; }, 10); const mediaQuery = window.matchMedia('(max-width:768px)'); const adjustLayout = () => { if (mediaQuery.matches) { popup.style.flexDirection = 'row'; popup.style.padding = '12px 4%'; popup.style.alignItems = 'flex-start'; imgEl.style.width = '66px'; imgEl.style.height = '66px'; imgEl.style.marginRight = '12px'; rightContainer.style.justifyContent = 'flex-start'; rightContainer.style.gap = '8px'; rightContainer.style.marginTop = '0'; rightContainer.style.alignItems = 'flex-start'; titleEl.style.fontSize = '14px'; titleEl.style.textAlign = 'left'; actionContainer.style.justifyContent = 'flex-start'; actionContainer.style.gap = '8px'; actionContainer.style.width = '100%'; promoBubble.style.minWidth = '90px'; promoBubble.style.padding = '5px 10px'; promoBubble.style.fontSize = '12px'; promoBubble.style.marginLeft = '0'; closeBtn.style.width = '25px'; closeBtn.style.height = '25px'; closeImg.style.width = '20px'; closeImg.style.height = '20px'; } else { popup.style.flexDirection = 'row'; popup.style.padding = '10px 5%'; popup.style.alignItems = 'center'; imgEl.style.width = '80px'; imgEl.style.height = '80px'; imgEl.style.marginRight = '20px'; rightContainer.style.justifyContent = 'center'; rightContainer.style.gap = '8px'; rightContainer.style.alignItems = 'flex-start'; titleEl.style.fontSize = '16px'; titleEl.style.textAlign = 'left'; actionContainer.style.justifyContent = 'flex-start'; actionContainer.style.gap = '10px'; popup.style.paddingLeft = '15%'; popup.style.paddingRight = '5%'; promoBubble.style.minWidth = '100px'; promoBubble.style.padding = '6px 12px'; promoBubble.style.fontSize = '14px'; closeBtn.style.width = '30px'; closeBtn.style.height = '30px'; closeImg.style.width = '24px'; closeImg.style.height = '24px'; } }; adjustLayout(); mediaQuery.addEventListener('change', adjustLayout); } else { alert('âœ… Favori enregistrÃ© (aucune promo disponible).'); } } catch (err) { console.error(err); alert('ðŸš¨ Erreur de communication avec le serveur.'); } });",
   "buttonHTML": "<button id=\"add-fav\" style=\"border: none; padding: 10px 20px; border-radius: 9999px; background: #ff4081; color: white; font-weight: 600; cursor: pointer;\">ðŸ’– Ajouter en favoris</button>"
}